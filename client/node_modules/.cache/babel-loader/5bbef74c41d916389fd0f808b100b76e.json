{"ast":null,"code":"import _slicedToArray from \"/Users/lukas/Documents/GitHub/spotify-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/lukas/Documents/GitHub/spotify-app/src/pages/savedSongs/index.tsx\";\nimport React, { useEffect, useState, memo } from \"react\";\nimport { SAVED_TRACKS_QUERY, USER_PLAYLISTS_QUERY, USER_DETAILS_QUERY, ADD_TO_PLAYLIST_QUERY } from \"../../graphqlQueries\";\nimport { QueryError } from \"../../components/queryError\";\nimport { Button } from \"../../components/button\";\nimport { client } from \"../../App\";\nimport { Card } from \"./card\";\nimport { Modal } from \"../../components/modal\";\nimport { PlaylistModalBody } from \"./savedModalBody\";\nimport { CardBody } from \"../../components/cardBody\";\nimport { Alert } from \"../../components/alert\";\nimport { Query } from \"react-apollo\";\nimport { getStorageData, setStorageData } from \"../../utilities/localStorage\";\nimport \"./SavedSongs.css\";\nimport \"../../Shared.css\";\nconst SavedSongs = memo(props => {\n  const _useState = useState(\"\"),\n        _useState2 = _slicedToArray(_useState, 2),\n        username = _useState2[0],\n        setUsername = _useState2[1];\n\n  const _useState3 = useState({\n    id: \"\",\n    name: \"\"\n  }),\n        _useState4 = _slicedToArray(_useState3, 2),\n        currentPlaylist = _useState4[0],\n        setCurrentPlaylist = _useState4[1];\n\n  const _useState5 = useState([]),\n        _useState6 = _slicedToArray(_useState5, 2),\n        userPlaylists = _useState6[0],\n        setUserPlaylists = _useState6[1];\n\n  const _useState7 = useState([]),\n        _useState8 = _slicedToArray(_useState7, 2),\n        songIds = _useState8[0],\n        setSongIds = _useState8[1];\n\n  const _useState9 = useState([]),\n        _useState10 = _slicedToArray(_useState9, 2),\n        savedSongs = _useState10[0],\n        setSavedSongs = _useState10[1];\n\n  const _useState11 = useState(false),\n        _useState12 = _slicedToArray(_useState11, 2),\n        modalState = _useState12[0],\n        setModalState = _useState12[1];\n\n  const _useState13 = useState(\"\"),\n        _useState14 = _slicedToArray(_useState13, 2),\n        isSavedPlaylist = _useState14[0],\n        setIsSavedPlaylist = _useState14[1];\n\n  useEffect(() => {\n    const ids = getStorageData(\"saved_tracks\");\n    setSongIds(ids);\n    userQuery(playlistQuery);\n  }, []);\n\n  const userQuery = fn => {\n    client.query({\n      query: USER_DETAILS_QUERY\n    }).then(({\n      data: {\n        userDetails: {\n          display_name\n        }\n      }\n    }) => {\n      fn(display_name);\n      setUsername(display_name);\n    }).catch(err => React.createElement(QueryError, {\n      pushHistory: props.history.push,\n      errorMessage: err.message,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 47\n      },\n      __self: this\n    }));\n  };\n\n  const playlistQuery = username => {\n    client.query({\n      query: USER_PLAYLISTS_QUERY,\n      variables: {\n        username\n      }\n    }).then(result => {\n      setCurrentPlaylist(result.data.userPlaylists[0]);\n      setUserPlaylists(result.data.userPlaylists);\n    }).catch(err => console.log(\"ERROR\", err));\n  };\n\n  const addToPlaylistQuery = () => {\n    if (currentPlaylist.id) client.query({\n      query: ADD_TO_PLAYLIST_QUERY,\n      variables: {\n        songIds: getStorageData(\"saved_tracks\"),\n        playlist_id: currentPlaylist.id\n      }\n    }).then(result => {\n      setIsSavedPlaylist(result.data.addToPlaylist.snapshot_id);\n      setTimeout(function () {\n        setIsSavedPlaylist(\"\");\n      }, 2000);\n    }).catch(err => console.log(\"ERROR\", err));\n  };\n\n  const removeSong = trackId => {\n    const newSongTracks = savedSongs.filter(item => item.id !== trackId);\n    const newSongIds = songIds.filter(item => item !== trackId);\n    setSongIds(newSongIds);\n    setSavedSongs(newSongTracks);\n    setStorageData(\"saved_tracks\", newSongIds);\n  };\n\n  const handleSelectChange = value => {\n    setCurrentPlaylist(value);\n  };\n\n  const renderSongs = songs => {\n    return songs.map((song, index) => React.createElement(\"div\", {\n      key: song.id,\n      className: \"d-flex justify-content-center align-items-center mb-5 flex-column col-12 col-md-6 col-lg-4\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    }, React.createElement(Card, {\n      key: index,\n      image: song.album.images.url,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }), React.createElement(CardBody, {\n      artists: song.artists,\n      preview_url: song.preview_url,\n      name: song.name,\n      style: {\n        name: \"heading__primary-small mb-2 mt-2 text-center\",\n        artist: \"heading__secondary-small mb-3 text-center text-white\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"heading__secondary-small mt-2 text-primary\",\n      style: {\n        cursor: \"pointer\"\n      },\n      onClick: () => removeSong(song.id),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140\n      },\n      __self: this\n    }, \"Remove this song\")));\n  };\n\n  const getPlaylistId = name => {\n    const playlist = userPlaylists.filter(item => item.name === name);\n    return playlist[0].id;\n  };\n\n  const renderPlaylists = arr => arr.map((item, index) => React.createElement(\"option\", {\n    key: index,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }, item.name));\n\n  const changeModalState = () => {\n    return setModalState(!modalState);\n  };\n\n  const renderNoTracksMessage = () => React.createElement(\"div\", {\n    className: \"heading__primary content-wrapper d-flex justify-content-center\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167\n    },\n    __self: this\n  }, \"You haven't saved any tracks yet.\");\n\n  return songIds && React.createElement(Query, {\n    query: SAVED_TRACKS_QUERY,\n    variables: {\n      savedTracks: songIds\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174\n    },\n    __self: this\n  }, properties => {\n    if (properties.loading) return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176\n      },\n      __self: this\n    }, \"Loading...\");\n\n    if (properties.error) {\n      return React.createElement(QueryError, {\n        pushHistory: props.history.push,\n        errorMessage: properties.error.graphQLErrors[0].message,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179\n        },\n        __self: this\n      });\n    } else {\n      if (!savedSongs.length && !getStorageData(\"saved_tracks\").length) return renderNoTracksMessage();\n      !savedSongs.length && setSavedSongs(properties.data.savedTracks);\n      return username && currentPlaylist ? React.createElement(\"div\", {\n        className: \"content-wrapper\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        },\n        __self: this\n      }, isSavedPlaylist ? React.createElement(Alert, {\n        message: \"Selected songs were successfully added to your playlist\",\n        isSuccess: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }) : null, React.createElement(Modal, {\n        show: modalState,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200\n        },\n        __self: this\n      }, React.createElement(PlaylistModalBody, {\n        name: currentPlaylist.name,\n        changeModalState: () => changeModalState(),\n        addToPlaylist: () => addToPlaylistQuery(),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"d-flex justify-content-center align-items-center mb-3 flex-column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"heading__primary mb-3\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      }, \"Choose your playlist\"), React.createElement(\"select\", {\n        className: \"select-input\",\n        onChange: e => handleSelectChange({\n          name: e.target.value,\n          id: getPlaylistId(e.target.value)\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211\n        },\n        __self: this\n      }, renderPlaylists(userPlaylists)), React.createElement(Button, {\n        type: \"primary\",\n        title: \"Add these songs to \\\"\".concat(currentPlaylist.name, \"\\\"\"),\n        action: () => {\n          changeModalState();\n        },\n        colors: \"bg-primary text-white\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231\n        },\n        __self: this\n      }, renderSongs(savedSongs))) : React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      }, \"Please login\");\n    }\n  });\n});\nexport default SavedSongs;","map":{"version":3,"sources":["/Users/lukas/Documents/GitHub/spotify-app/src/pages/savedSongs/index.tsx"],"names":["React","useEffect","useState","memo","SAVED_TRACKS_QUERY","USER_PLAYLISTS_QUERY","USER_DETAILS_QUERY","ADD_TO_PLAYLIST_QUERY","QueryError","Button","client","Card","Modal","PlaylistModalBody","CardBody","Alert","Query","getStorageData","setStorageData","SavedSongs","props","username","setUsername","id","name","currentPlaylist","setCurrentPlaylist","userPlaylists","setUserPlaylists","songIds","setSongIds","savedSongs","setSavedSongs","modalState","setModalState","isSavedPlaylist","setIsSavedPlaylist","ids","userQuery","playlistQuery","fn","query","then","data","userDetails","display_name","catch","err","history","push","message","variables","result","console","log","addToPlaylistQuery","playlist_id","addToPlaylist","snapshot_id","setTimeout","removeSong","trackId","newSongTracks","filter","item","newSongIds","handleSelectChange","value","renderSongs","songs","map","song","index","album","images","url","artists","preview_url","artist","cursor","getPlaylistId","playlist","renderPlaylists","arr","changeModalState","renderNoTracksMessage","savedTracks","properties","loading","error","graphQLErrors","length","e","target"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, memo } from \"react\";\nimport {\n  SAVED_TRACKS_QUERY,\n  USER_PLAYLISTS_QUERY,\n  USER_DETAILS_QUERY,\n  ADD_TO_PLAYLIST_QUERY\n} from \"../../graphqlQueries\";\nimport { SAVED_TRACKS_ERROR, UNAUTHORIZED } from \"../../utilities/errorTypes\";\nimport { QueryError } from \"../../components/queryError\";\nimport { Button } from \"../../components/button\";\nimport { client } from \"../../App\";\nimport { Card } from \"./card\";\nimport { Modal } from \"../../components/modal\";\nimport { PlaylistModalBody } from \"./savedModalBody\";\nimport { CardBody } from \"../../components/cardBody\";\nimport { Alert } from \"../../components/alert\";\nimport { Query } from \"react-apollo\";\nimport { getStorageData, setStorageData } from \"../../utilities/localStorage\";\nimport \"./SavedSongs.css\";\nimport \"../../Shared.css\";\n\nconst SavedSongs = memo((props: any) => {\n  const [username, setUsername] = useState(\"\");\n  const [currentPlaylist, setCurrentPlaylist] = useState({ id: \"\", name: \"\" });\n  const [userPlaylists, setUserPlaylists] = useState([]);\n  const [songIds, setSongIds] = useState([]);\n  const [savedSongs, setSavedSongs] = useState([]);\n  const [modalState, setModalState] = useState(false);\n  const [isSavedPlaylist, setIsSavedPlaylist] = useState(\"\");\n\n  useEffect(() => {\n    const ids = getStorageData(\"saved_tracks\");\n    setSongIds(ids);\n    userQuery(playlistQuery);\n  }, []);\n\n  const userQuery = (fn: (args: any) => void) => {\n    client\n      .query({\n        query: USER_DETAILS_QUERY\n      })\n      .then(({ data: { userDetails: { display_name } } }) => {\n        fn(display_name);\n        setUsername(display_name);\n      })\n      .catch(err => (\n        <QueryError\n          pushHistory={props.history.push}\n          errorMessage={err.message}\n        />\n      ));\n  };\n\n  const playlistQuery = (username: string) => {\n    client\n      .query({\n        query: USER_PLAYLISTS_QUERY,\n        variables: { username }\n      })\n      .then(result => {\n        setCurrentPlaylist(result.data.userPlaylists[0]);\n        setUserPlaylists(result.data.userPlaylists);\n      })\n      .catch(err => console.log(\"ERROR\", err));\n  };\n\n  const addToPlaylistQuery = () => {\n    if (currentPlaylist.id)\n      client\n        .query({\n          query: ADD_TO_PLAYLIST_QUERY,\n          variables: {\n            songIds: getStorageData(\"saved_tracks\"),\n            playlist_id: currentPlaylist.id\n          }\n        })\n        .then(result => {\n          setIsSavedPlaylist(result.data.addToPlaylist.snapshot_id);\n          setTimeout(function() {\n            setIsSavedPlaylist(\"\");\n          }, 2000);\n        })\n        .catch(err => console.log(\"ERROR\", err));\n  };\n\n  const removeSong = (trackId: string) => {\n    const newSongTracks = savedSongs.filter(\n      (item: {\n        id: string;\n        album: { images: { url: string } };\n        artists: { name: string }[];\n        preview_url: string;\n        name: string;\n      }) => item.id !== trackId\n    );\n    const newSongIds = songIds.filter((item: string) => item !== trackId);\n    setSongIds(newSongIds);\n    setSavedSongs(newSongTracks);\n    setStorageData(\"saved_tracks\", newSongIds);\n  };\n\n  const handleSelectChange = (value: { name: string; id: string }) => {\n    setCurrentPlaylist(value);\n  };\n\n  const renderSongs = (\n    songs: {\n      id: string;\n      album: { images: { url: string } };\n      artists: { name: string }[];\n      preview_url: string;\n      name: string;\n    }[]\n  ) => {\n    return songs.map(\n      (\n        song: {\n          id: string;\n          album: { images: { url: string } };\n          artists: { name: string }[];\n          preview_url: string;\n          name: string;\n        },\n        index: number\n      ) => (\n        <div\n          key={song.id}\n          className=\"d-flex justify-content-center align-items-center mb-5 flex-column col-12 col-md-6 col-lg-4\"\n        >\n          <Card key={index} image={song.album.images.url} />\n          <CardBody\n            artists={song.artists}\n            preview_url={song.preview_url}\n            name={song.name}\n            style={{\n              name: \"heading__primary-small mb-2 mt-2 text-center\",\n              artist: \"heading__secondary-small mb-3 text-center text-white\"\n            }}\n          />\n          <div\n            className=\"heading__secondary-small mt-2 text-primary\"\n            style={{ cursor: \"pointer\" }}\n            onClick={() => removeSong(song.id)}\n          >\n            Remove this song\n          </div>\n        </div>\n      )\n    );\n  };\n\n  const getPlaylistId = (name: string): string => {\n    const playlist: { name: string; id: string }[] = userPlaylists.filter(\n      (item: { name: string; id: string }) => item.name === name\n    );\n    return playlist[0].id;\n  };\n\n  const renderPlaylists = (arr: { name: string; id: string }[]) =>\n    arr.map((item, index) => <option key={index}>{item.name}</option>);\n\n  const changeModalState = () => {\n    return setModalState(!modalState);\n  };\n\n  const renderNoTracksMessage = () => (\n    <div className=\"heading__primary content-wrapper d-flex justify-content-center\">\n      You haven't saved any tracks yet.\n    </div>\n  );\n\n  return (\n    songIds && (\n      <Query query={SAVED_TRACKS_QUERY} variables={{ savedTracks: songIds }}>\n        {(properties: any) => {\n          if (properties.loading) return <div>Loading...</div>;\n          if (properties.error) {\n            return (\n              <QueryError\n                pushHistory={props.history.push}\n                errorMessage={properties.error.graphQLErrors[0].message}\n              />\n            );\n          } else {\n            if (!savedSongs.length && !getStorageData(\"saved_tracks\").length)\n              return renderNoTracksMessage();\n\n            !savedSongs.length && setSavedSongs(properties.data.savedTracks);\n\n            return username && currentPlaylist ? (\n              <div className=\"content-wrapper\">\n                {isSavedPlaylist ? (\n                  <Alert\n                    message={\n                      \"Selected songs were successfully added to your playlist\"\n                    }\n                    isSuccess={true}\n                  />\n                ) : null}\n                <Modal show={modalState}>\n                  <PlaylistModalBody\n                    name={currentPlaylist.name}\n                    changeModalState={() => changeModalState()}\n                    addToPlaylist={() => addToPlaylistQuery()}\n                  />\n                </Modal>\n                <div className=\"d-flex justify-content-center align-items-center mb-3 flex-column\">\n                  <div className=\"heading__primary mb-3\">\n                    Choose your playlist\n                  </div>\n                  <select\n                    className=\"select-input\"\n                    onChange={e =>\n                      handleSelectChange({\n                        name: e.target.value,\n                        id: getPlaylistId(e.target.value)\n                      })\n                    }\n                  >\n                    {renderPlaylists(userPlaylists)}\n                  </select>\n                  <Button\n                    type={\"primary\"}\n                    title={`Add these songs to \"${currentPlaylist.name}\"`}\n                    action={() => {\n                      changeModalState();\n                    }}\n                    colors={\"bg-primary text-white\"}\n                  />\n                </div>\n                <div className=\"row\">{renderSongs(savedSongs)}</div>\n              </div>\n            ) : (\n              <div>Please login</div>\n            );\n          }\n        }}\n      </Query>\n    )\n  );\n});\n\nexport default SavedSongs;\n"]},"metadata":{},"sourceType":"module"}